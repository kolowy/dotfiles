<html>

<head>
    <meta>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="stylesheet" href="">
</head>

<body style="background-color: black;">
    <button id='trimToOffsetSimple'>Trim to Offset Simple</button>
    <button id='trimToOffsetBezier'>Trim to Offset Bezier</button>
    <button id='generateOpacity'>Opacity</button>
    <div id="bm"></div>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.5/lottie.min.js"></script> -->
    <script src="lottie_svg.js"></script>

    <script>
        var animation = bodymovin.loadAnimation({
            container: document.getElementById('bm'),
            renderer: 'svg',
            loop: false,
            autoplay: true,
            path: './data.json'
        })

        document.getElementById('trimToOffsetBezier').addEventListener('click', (e) => {
            let paths = document.querySelectorAll("path:not([id*='Scale'])");
            let text = [];
            let animate;
            console.log(lottie.exportTrimAnim);
            console.log(paths);
            for (var i = 0; i < paths.length; i++) {
                let path = paths[i];
                let l = path.getTotalLength();
                var begin = 0;
                var end = 0;
                let keyTimes = [];
                let values = [];
                let keySplines = [];
                path.setAttribute('stroke-dasharray', l)
                // console.log(path.id);
                for (var j = 0; j < lottie.exportTrimAnim.length; j++) {
                    var d = lottie.exportTrimAnim[j];
                    if (path.id.indexOf(d.id > -1)) {
                        keyTimes = lottie.exportTrimAnim[j].keyTimes;
                        keySplines = lottie.exportTrimAnim[j].keySplines.join('; ');
                        let values = lottie.exportTrimAnim[j].values.map(e => {
                            e = 1 - e;
                            if (e === 0) {
                                return 0;
                            } else {
                                return (l * e).toFixed(3);
                            }
                        })
                        let a = 'animate'
                        let animate = `<${a} href="#${path.id}" attributeName="${'stroke-dashoffset'}" dur="${d.dur}" values="${values.join('; ')}" keyTimes="${keyTimes.join('; ')}" calcMode="spline" keySplines="${keySplines}" repeatCount="once" fill="freeze"/>`;
                        text.push(animate);
                        break;
                    }
                }
            }
            console.log(text.join('\n'));
        });

        document.getElementById('trimToOffsetSimple').addEventListener('click', (e) => {
            let paths = document.querySelectorAll("path:not([id*='Scale'])");
            console.log(paths);
            let text = [];
            console.log(lottie.exportTrimAnim);
            for (var i = 0; i < paths.length; i++) {
                let path = paths[i];
                let l = path.getTotalLength();
                var begin = 0;
                var end = 0;
                let dur = 0;
                let keyTimes = [0, 0, 1, 1];
                let values;
                path.setAttribute('stroke-dasharray', l)
                for (var j = 0; j < lottie.exportTrimAnim.length; j++) {

                    // if (path.id.indexOf(lottie.exportTrimAnim[j].id.replaceAll(" ", "")) > -1) {
                    if (path.id.indexOf(lottie.exportTrimAnim[j].id.replace(" ", "")) > -1) {
                        // keyTimes = lottie.exportTrimAnim[j].keyTimes.replaceAll(',', ';');
                        keyTimes = [0, 0, 1, 1].toString().replaceAll(',', ';');
                        dur = lottie.exportTrimAnim[j].dur;
                        values = lottie.exportTrimAnim[j].values;
                        // begin = lottie.exportTrimAnim[j].begin;
                        // end = lottie.exportTrimAnim[j].end;
                        break;
                    }
                }
                let a = 'animate'
                let attributeType = '';
                let value = l;
                values = [l, l, 0, 0];
                // let values = [0, 0, l, l];

                // let animate = `<${a} href="#${path.id}" attributeName="${'stroke-dashoffset'}" ${attributeType} begin="${begin}" dur="${25 / 24}" from="${l}" to="${0}" repeatCount="once" />`;
                // let animate = `<${a} href="#${path.id}" attributeName="${'stroke-dashoffet'}" ${attributeType} dur="${dur}" values="${values.join('; ')}" keyTimes="${keyTimes.join('; ')}" repeatCount="once" />`;
                // let animate = `<${a} href="#${path.id}" attributeName="${'stroke-dashoffset'}" ${attributeType} dur="${dur}" values="${values.join('; ')}" keyTimes="${keyTimes.join('; ')}" repeatCount="indefinite" />`;
                let animate = `<${a} href="#${path.id}" attributeName="${'stroke-dashoffset'}" ${attributeType} dur="${dur}" values="${values.join('; ')}" keyTimes="${keyTimes}" repeatCount="indefinite" />`;

                text.push(animate);
            }
            console.log(text.join('\n'));
        });

        document.getElementById('generateOpacity').addEventListener('click', (e) => {
            let groups = document.querySelectorAll('g[id]');
            let attributeName = 'opacity';
            let animate;
            let text = [];
            console.log(lottie.exportTrimAnim);
            for (var j = 0; j < lottie.exportTrimAnim.length; j++) {
                var d = lottie.exportTrimAnim[j];
                var tag = 'animate';
                var additive = 'sum';
                var calcMode = 'spline';

                if(d.propType == 'opacity'){
                    animate = `<${tag} href="#${d.id}" attributeName="${d.propType}" dur="${d.dur}" values="${d.values.join('; ')}" keyTimes="${d.keyTimes.join('; ')}" calcMode="${calcMode}" keySplines="${d.keySplines.join('; ')}" repeatCount="once" fill="freeze"/>`;
                    text.push(animate);//                 text.push(animate);

                }
            }
            for (var i = 0; i < groups.length; i++) {
                // console.log(groups[i].id);
            }
            console.log(text.join('\n'));
        });


    </script>
</body>


</html>